<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PIG Game — настраиваемое количество игроков</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ef4444;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{margin:0;background:linear-gradient(180deg,#071224 0%,#071a2a 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .container{width:1200px;max-width:100%;display:grid;grid-template-columns:1fr 320px;gap:20px}
    .board{background:var(--card);border-radius:12px;padding:20px;display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
    .player{background:var(--glass);padding:16px;border-radius:10px;position:relative;display:flex;flex-direction:column;align-items:center;transition:all .3s ease}
    .player.active{box-shadow:0 0 25px rgba(239,68,68,0.6),0 0 0 3px rgba(239,68,68,0.3);transform:scale(1.04);z-index:2}
    .player.out{opacity:0.4;}
    .player h2{margin:0 0 8px;font-size:18px}
    .score{font-size:44px;font-weight:700}
    .current-box{margin-top:12px;background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;width:100%;text-align:center}
    .current-box small{display:block;color:var(--muted);font-size:12px}
    .controls{background:var(--card);border-radius:12px;padding:18px;display:flex;flex-direction:column;gap:12px;align-items:center}
    .dice{font-size:64px;height:90px;width:90px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.03);border-radius:12px}
    .btn{padding:10px 18px;border-radius:10px;background:linear-gradient(180deg,#1f2937,#0b1220);border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:inherit}
    .btn:active{transform:translateY(1px)}
    .btn.red{background:linear-gradient(180deg,#ef4444,#dc2626);color:#fff}
    .row{display:flex;gap:8px}
    input[type=number]{width:60px;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    footer{grid-column:1/-1;color:var(--muted);font-size:13px;text-align:center;margin-top:8px}
    @media (max-width:820px){.container{grid-template-columns:1fr;}.board{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <div class="board" id="board"></div>

    <div class="controls">
      <div class="row" style="margin-bottom:8px;align-items:center">
        <label for="numPlayers">Игроков:</label>
        <input type="number" id="numPlayers" min="2" max="8" value="4" />
        <button class="btn" id="btn-start">Начать игру</button>
      </div>
      <div class="dice" id="dice">—</div>
      <div class="row">
        <button class="btn" id="btn-roll">Бросить</button>
        <button class="btn" id="btn-hold">Удержать</button>
        <button class="btn red" id="btn-new">Новая игра</button>
      </div>
      <div class="row" style="align-items:center;margin-top:6px">
        <label for="target">Цель очков:</label>
        <input id="target" type="number" min="1" value="100" />
      </div>
      <div style="width:100%;color:var(--muted);font-size:13px;text-align:center;margin-top:6px">Если выпадает 1 — ход переходит следующему активному игроку.</div>
    </div>

    <footer>Игра PIG — настрой количество игроков перед началом.</footer>
  </div>

  <script>
    let numPlayers = 4;
    let scores, currentScore, activePlayer, playing, activePlayers, places;
    const diceFaces = ['⚀','⚁','⚂','⚃','⚄','⚅'];
    let players = [], scoreEls = [], currentEls = [];

    const board = document.getElementById('board');
    const diceEl = document.getElementById('dice');
    const btnRoll = document.getElementById('btn-roll');
    const btnHold = document.getElementById('btn-hold');
    const btnNew = document.getElementById('btn-new');
    const btnStart = document.getElementById('btn-start');
    const numPlayersInput = document.getElementById('numPlayers');
    const targetInput = document.getElementById('target');

    function createPlayers(n){
      board.innerHTML='';
      players=[]; scoreEls=[]; currentEls=[];
      for(let i=0;i<n;i++){
        const div=document.createElement('div');
        div.className='player';
        div.innerHTML=`<h2>Игрок ${i+1}</h2><div class='score' id='score-${i}'>0</div><div class='current-box'><small>Текущий счёт</small><div id='current-${i}'>0</div></div>`;
        board.appendChild(div);
        players.push(div);
        scoreEls.push(div.querySelector('.score'));
        currentEls.push(div.querySelector('#current-'+i));
      }
    }

    function init(){
      numPlayers = Number(numPlayersInput.value)||4;
      createPlayers(numPlayers);
      scores = Array(numPlayers).fill(0);
      currentScore=0;
      activePlayer=0;
      playing=true;
      activePlayers = [...Array(numPlayers).keys()];
      places=[];
      scoreEls.forEach(el=>el.textContent='0');
      currentEls.forEach(el=>el.textContent='0');
      players.forEach(p=>{p.classList.remove('active');p.classList.remove('out');});
      players[activePlayer].classList.add('active');
      diceEl.textContent='—';
    }

    function switchPlayer(){
      currentScore=0;
      currentEls[activePlayer].textContent='0';
      players[activePlayer].classList.remove('active');
      let idx=activePlayers.indexOf(activePlayer);
      idx=(idx+1)%activePlayers.length;
      activePlayer=activePlayers[idx];
      players[activePlayer].classList.add('active');
    }

    function eliminatePlayer(){
      players[activePlayer].classList.add('out');
      activePlayers = activePlayers.filter(p=>p!==activePlayer);
      places.push(activePlayer+1);
      if(activePlayers.length===1){
        places.push(activePlayers[0]+1);
        alert('Игра окончена! Места: '+places.join(', '));
        playing=false;
      } else {
        let idx=0;
        if(activePlayers.includes(activePlayer)) idx=activePlayers.indexOf(activePlayer);
        activePlayer=activePlayers[idx%activePlayers.length];
        players[activePlayer].classList.add('active');
      }
    }

    btnRoll.addEventListener('click',()=>{
      if(!playing) return;
      const dice=Math.trunc(Math.random()*6)+1;
      diceEl.textContent=diceFaces[dice-1];
      diceEl.animate([{transform:'scale(0.9)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:220,easing:'ease-out'});
      if(dice!==1){
        currentScore+=dice;
        currentEls[activePlayer].textContent=currentScore;
      } else switchPlayer();
    });

    btnHold.addEventListener('click',()=>{
      if(!playing) return;
      scores[activePlayer]+=currentScore;
      scoreEls[activePlayer].textContent=scores[activePlayer];
      const target=Number(targetInput.value)||100;
      if(scores[activePlayer]>=target){
        eliminatePlayer();
      } else switchPlayer();
    });

    btnNew.addEventListener('click',init);
    btnStart.addEventListener('click',init);

    init();
  </script>
</body>
</html>